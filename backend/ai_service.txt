# ai_service.py (STABLE – dùng cho đồ án)
import os
import google.generativeai as genai
from dotenv import load_dotenv

load_dotenv()

genai.configure(api_key=os.getenv("GEMINI_API_KEY"))

model = genai.GenerativeModel("gemini-pro")

# =========================
# SUMMARY (WEB)
# =========================
def generate_summary(name, birth_date, numbers, knowledge=""):
    prompt = f"""
Bạn là chuyên gia Thần số học Pitago người Việt.

Họ tên: {name}
Ngày sinh: {birth_date}

Life Path: {numbers['life_path']}
Destiny: {numbers['destiny']}
Soul: {numbers['soul']}
Personality: {numbers['personality']}

Kiến thức tham khảo (trích từ sách):
{knowledge}

Yêu cầu:
- Viết tiếng Việt rõ ràng, mạch lạc
- Không bịa đặt
- Không lặp từ
- Không sao chép nguyên văn
- Độ dài 3–5 đoạn ngắn

Phân tích:
- Tính cách tổng quát
- Điểm mạnh / điểm yếu
- Nghề nghiệp phù hợp
- Định hướng phát triển
"""

    response = model.generate_content(prompt)
    return response.text.strip()



# =========================
# FULL REPORT (PDF)
# =========================
SECTIONS = [
    ("Tính cách", "Phân tích tính cách nổi bật."),
    ("Điểm mạnh & điểm yếu", "Nêu điểm mạnh, điểm yếu và lời khuyên."),
    ("Nghề nghiệp phù hợp", "Gợi ý nghề nghiệp và môi trường làm việc."),
    ("Mối quan hệ", "Phân tích tình cảm và các mối quan hệ."),
    ("Định hướng cuộc sống", "Định hướng phát triển trong 3–6 tháng tới."),
]

def generate_full_report(name, birth_date, numbers):
    parts = []

    for title, instruction in SECTIONS:
        prompt = f"""
Bạn là chuyên gia Thần số học Pitago người Việt.

Họ tên: {name}
Ngày sinh: {birth_date}

Chỉ số:
- Life Path: {numbers['life_path']}
- Destiny: {numbers['destiny']}
- Soul: {numbers['soul']}
- Personality: {numbers['personality']}

Yêu cầu:
- Viết mục: {title}
- {instruction}
- Tiếng Việt chuẩn
- 6–10 câu
"""

        response = model.generate_content(prompt)
        parts.append(f"{title}:\n{response.text.strip()}")

    return "\n\n".join(parts)
